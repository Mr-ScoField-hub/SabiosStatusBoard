<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Agile Sprint Timeline</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
        }

        .container {
            max-width: 400px;
            width: 100%;
            background: white;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: relative;
        }

        .title {
            text-align: center;
            font-size: 24px;
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 32px;
        }

        .timeline {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 0 auto 20px;
        }

        .circle-bg {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 8px solid #e2e8f0;
            border-radius: 50%;
        }

        .circle-progress {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(#3b82f6 0deg,
                    #3b82f6 var(--progress-angle, 0deg),
                    transparent var(--progress-angle, 0deg));
            mask: radial-gradient(circle at center, transparent 140px, black 148px);
            transition: background 0.3s linear;
        }

        .milestone {
            position: absolute;
            width: 60px;
            height: 60px;
            background: white;
            border: 4px solid #e2e8f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            z-index: 10;
            color: #6b7280;
            font-weight: 600;
            font-size: 12px;
            user-select: none;
            text-align: center;
            padding: 5px;
        }

        .milestone.start {
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            border-color: #3b82f6;
            color: #3b82f6;
            font-weight: 700;
        }

        .milestone.initial {
            bottom: 40px;
            left: 20px;
            border-color: #3b82f6;
            color: #3b82f6;
            font-weight: 700;
        }

        .milestone.final {
            bottom: 40px;
            right: 20px;
            border-color: #3b82f6;
            color: #3b82f6;
            font-weight: 700;
        }

        .milestone-labels {
            margin-top: 20px;
        }

        .label {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid #e2e8f0;
            margin-bottom: 12px;
        }

        .label.active {
            background: #eff6ff;
            border-left-color: #3b82f6;
        }

        .label-icon {
            width: 20px;
            height: 20px;
            stroke: #6b7280;
            fill: none;
            stroke-width: 2;
            flex-shrink: 0;
        }

        .label.active .label-day {
            color: #3b82f6;
        }

        .label-day {
            font-size: 14px;
            font-weight: 600;
            color: #1a202c;
        }

        .label-task {
            font-size: 12px;
            color: #6b7280;
        }

        .sprint-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: white;
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 2px solid #f1f5f9;
            user-select: none;
        }

        .sprint-label {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .countdown {
            font-size: 28px;
            font-weight: 700;
            color: #1a202c;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="title">Sprint Timeline</h1>

        <div class="timeline">
            <div class="circle-bg"></div>
            <div class="circle-progress" id="progress"></div>

            <div class="milestone start">Wed<br>Start</div>
            <div class="milestone initial">Sun<br>Submission</div>
            <div class="milestone final">Tue<br>Final</div>

            <div class="sprint-center">
                <div class="sprint-label">Next milestone in</div>
                <div class="countdown" id="countdown">--:--:--</div>
            </div>
        </div>

        <div class="milestone-labels">
            <div class="label" id="label-start">
                <div class="label-day">Wednesday</div>
                <div class="label-task">Start New Sprint</div>
            </div>
            <div class="label" id="label-initial">
                <div class="label-day">Sunday</div>
                <div class="label-task">Initial Submission</div>
            </div>
            <div class="label" id="label-final">
                <div class="label-day">Tuesday</div>
                <div class="label-task">Final Submission & Meeting</div>
            </div>
        </div>
    </div>

    <script>
        // Milestones info: day index in week and label
        // Wed=3, Sun=0, Tue=2
        // We'll use days 3 (Wed), 0 (Sun), 2 (Tue) and map into cycle order: Wed → Sun → Tue → Wed ...
        // Calculate next milestone time and progress arc angle based on current time.

        const milestones = [
            { name: "Start Sprint", day: 3 },  // Wednesday
            { name: "Initial Submission", day: 0 }, // Sunday
            { name: "Final Submission", day: 2 }, // Tuesday
        ];

        // Helper: get next occurrence of a day (0-6) from now
        function getNextDayOfWeek(day, fromDate = new Date()) {
            const resultDate = new Date(fromDate.getTime());
            const currentDay = resultDate.getDay();
            let daysUntil = (day - currentDay + 7) % 7;
            if (daysUntil === 0) daysUntil = 7; // always get next, not today
            resultDate.setDate(resultDate.getDate() + daysUntil);
            resultDate.setHours(0, 0, 0, 0);
            return resultDate;
        }

        // Calculate current cycle segment between milestones and progress [0..1]
        function getCurrentCycleProgress(now) {
            // Sort milestones by day of week in sprint order: Wed(3) → Sun(0) → Tue(2)
            // We'll treat week starting Wed=day 3 as 0 for offset calculation.

            // Create ordered array in cycle: Wed(3), Sun(0), Tue(2)
            // For calculations, transform days to "offset" from Wed
            function dayOffset(d) {
                // Wed=0, Sun=4, Tue=6
                let offset = d - 3;
                if (offset < 0) offset += 7;
                return offset;
            }

            const nowDay = now.getDay();
            const nowOffset = dayOffset(nowDay);

            // Sort milestones by offset ascending
            const sorted = milestones
                .map(m => ({ ...m, offset: dayOffset(m.day) }))
                .sort((a, b) => a.offset - b.offset);

            // Find current segment: the two milestones surrounding nowOffset
            let currentIdx = 0;
            for (let i = 0; i < sorted.length; i++) {
                if (nowOffset < sorted[i].offset) {
                    currentIdx = i === 0 ? sorted.length - 1 : i - 1;
                    break;
                }
                if (i === sorted.length - 1) {
                    currentIdx = i;
                }
            }
            const startM = sorted[currentIdx];
            const endM = sorted[(currentIdx + 1) % sorted.length];

            // Compute progress between startM and endM relative to nowOffset
            let segmentLength = endM.offset - startM.offset;
            if (segmentLength <= 0) segmentLength += 7;
            let progressInSegment = nowOffset - startM.offset;
            if (progressInSegment < 0) progressInSegment += 7;
            let progressRatio = progressInSegment / segmentLength;

            return { startM, endM, progressRatio };
        }

        // Calculate angle (deg) on circle for a given offset (0 to 7)
        // Full circle 360deg, Wed=0deg at top (-90deg rotated)
        function offsetToAngle(offset) {
            return (offset / 7) * 360;
        }

        // Get datetime for a milestone on this or next week from now
        function getMilestoneDate(milestone, fromDate = new Date()) {
            // Milestone day mapped to absolute day in cycle (Wed=0 offset)
            // We'll find the next milestone day from now, including today if past midnight
            const nowDay = fromDate.getDay();
            let dayDiff = milestone.day - nowDay;
            if (dayDiff < 0) dayDiff += 7;

            // If today and time passed (midnight), go to next week
            if (dayDiff === 0 && fromDate.getHours() >= 0) {
                dayDiff = 7;
            }

            const dt = new Date(fromDate.getTime());
            dt.setHours(0, 0, 0, 0);
            dt.setDate(dt.getDate() + dayDiff);
            return dt;
        }

        // Format seconds to HH:mm:ss
        function formatTime(sec) {
            const h = Math.floor(sec / 3600);
            const m = Math.floor((sec % 3600) / 60);
            const s = sec % 60;
            return [h, m, s].map(x => x.toString().padStart(2, '0')).join(':');
        }

        // Main update loop
        function update() {
            const now = new Date();

            // Calculate progress in sprint cycle
            const { startM, endM, progressRatio } = getCurrentCycleProgress(now);

            // Calculate angles
            const startAngle = offsetToAngle(dayOffset(startM.day));
            const endAngle = offsetToAngle(dayOffset(endM.day));
            let angleDiff = endAngle - startAngle;
            if (angleDiff <= 0) angleDiff += 360;

            // Progress angle for conic-gradient
            let progressAngle = startAngle + angleDiff * progressRatio;

            // Set progress arc angle CSS variable
            const progressEl = document.getElementById('progress');
            progressEl.style.setProperty('--progress-angle', progressAngle + 'deg');

            // Find next milestone date/time (midnight start of day)
            let nextDate = getMilestoneDate(endM, now);

            // Calculate seconds to next milestone
            let diffMs = nextDate - now;
            if (diffMs < 0) diffMs = 0; // safety

            const diffSeconds = Math.floor(diffMs / 1000);

            // Update countdown timer text
            const countdownEl = document.getElementById('countdown');
            countdownEl.textContent = formatTime(diffSeconds);

            // Highlight active label
            ['label-start', 'label-initial', 'label-final'].forEach(id => {
                document.getElementById(id).classList.remove('active');
            });

            // Map milestone names to label ids
            const labelMap = {
                'Start Sprint': 'label-start',
                'Initial Submission': 'label-initial',
                'Final Submission': 'label-final',
            };
            const activeLabelId = labelMap[endM.name];
            if (activeLabelId) {
                document.getElementById(activeLabelId).classList.add('active');
            }
        }

        // Helper: Wed=3 offset helper function used above (copy here)
        function dayOffset(d) {
            let offset = d - 3;
            if (offset < 0) offset += 7;
            return offset;
        }

        // Initial update & set interval
        update();
        setInterval(update, 1000);
    </script>
</body>

</html>